<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Plagiarism Report - {{ report_data.document_analyzed.filename }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #f8f9fa;
        }
        .report-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .header-section {
            background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .content-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        .summary-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 30px;
        }
        .plagiarized-text {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
            padding: 2px 4px;
            margin: 1px 0;
            border-radius: 3px;
        }
        .similar-text {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 2px 4px;
            margin: 1px 0;
            border-radius: 3px;
        }
        .unique-text {
            background-color: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 2px 4px;
            margin: 1px 0;
            border-radius: 3px;
        }
        .chart-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        .source-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        .source-item:hover {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .similarity-badge {
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 20px;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .btn-action {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .btn-action:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        .document-content {
            line-height: 1.8;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #fafafa;
        }
        .source-header {
            display: flex;
            justify-content-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .matches-count {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="report-container">
        <!-- Header Section -->
        <div class="header-section">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 mb-3">
                        <i class="fas fa-shield-alt me-3"></i>Comprehensive Plagiarism Report
                    </h1>
                    <h4 class="mb-2">{{ report_data.document_analyzed.filename }}</h4>
                    <p class="mb-0 opacity-75">
                        <i class="fas fa-calendar me-2"></i>Generated on {{ report_data.generated_at[:10] }}
                        <span class="ms-4"><i class="fas fa-file-alt me-2"></i>{{ report_data.document_analyzed.word_count }} words</span>
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="similarity-badge badge 
                        {% if report_data.overall_summary.highest_similarity >= 80 %}bg-danger
                        {% elif report_data.overall_summary.highest_similarity >= 60 %}bg-warning
                        {% elif report_data.overall_summary.highest_similarity >= 30 %}bg-info
                        {% else %}bg-success{% endif %} fs-4 px-4 py-2">
                        {{ "%.0f"|format(report_data.overall_summary.highest_similarity) }}% Similarity
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Panel - Document Content -->
            <div class="col-lg-8">
                <div class="content-panel">
                    <h3 class="mb-4">
                        <i class="fas fa-file-text me-2"></i>Document Analysis
                    </h3>
                    
                    <!-- Document Details -->
                    <div class="mb-4">
                        <h5>{{ report_data.document_analyzed.filename }}</h5>
                        <p class="text-muted mb-0">Analyzed Document</p>
                    </div>

                    <!-- Document Content with Highlighting -->
                    <div class="document-content" id="highlightedContent">
                        <!-- Content will be highlighted by JavaScript -->
                        <div id="originalContent">{{ original_content }}</div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Summary and Sources -->
            <div class="col-lg-4">
                <div class="summary-panel">
                    <!-- Plagiarism Summary -->
                    <h4 class="mb-4">
                        <i class="fas fa-chart-pie me-2"></i>Plagiarism Summary
                    </h4>
                    
                    <div class="chart-container mb-4">
                        <canvas id="plagiarismChart"></canvas>
                    </div>
                    
                    <div class="text-center mb-4">
                        <div class="row">
                            <div class="col-6">
                                <h5 class="text-danger mb-1">{{ "%.0f"|format(report_data.overall_summary.highest_similarity) }}%</h5>
                                <small class="text-muted">Plagiarized Content</small>
                            </div>
                            <div class="col-6">
                                <h5 class="text-success mb-1">{{ "%.0f"|format(100 - report_data.overall_summary.highest_similarity) }}%</h5>
                                <small class="text-muted">Unique Content</small>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons mb-4">
                        <button class="btn btn-action" onclick="checkGrammar()">
                            <i class="fas fa-spell-check me-2"></i>Check Grammar
                        </button>
                        <button class="btn btn-action" onclick="removePlagiarism()">
                            <i class="fas fa-eraser me-2"></i>Remove Plagiarism
                        </button>
                        <button class="btn btn-action" onclick="downloadReport()">
                            <i class="fas fa-download me-2"></i>Download Report
                        </button>
                    </div>

                    <!-- Matches Section -->
                    <div class="source-header">
                        <h5 class="mb-0">
                            <i class="fas fa-search me-2"></i>Similarity Matches
                        </h5>
                        <span class="matches-count">{{ report_data.plagiarism_results|length }} Matches</span>
                    </div>

                    <div id="sourcesList">
                        {% if report_data.plagiarism_results %}
                            {% for match in report_data.plagiarism_results[:10] %}
                            <div class="source-item">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="mb-0">{{ match.filename }}</h6>
                                    <span class="similarity-badge badge bg-{{ match.color if match.color else 'secondary' }}">
                                        {{ "%.1f"|format(match.similarity_percentage) }}% Similar
                                    </span>
                                </div>
                                <p class="text-muted mb-1">
                                    <i class="fas fa-database me-1"></i>Database Document
                                </p>
                                <div class="small text-muted">
                                    <div>Cosine: {{ match.cosine_similarity if match.cosine_similarity is defined else 'N/A' }}%</div>
                                    <div>Sequence: {{ match.sequence_similarity if match.sequence_similarity is defined else 'N/A' }}%</div>
                                </div>
                            </div>
                            {% endfor %}
                            
                            {% if report_data.plagiarism_results|length > 10 %}
                            <button class="btn btn-outline-primary w-100 mt-2" onclick="showAllMatches()">
                                <i class="fas fa-plus me-2"></i>Show All Matches
                            </button>
                            {% endif %}
                        {% else %}
                            <div class="text-center text-muted py-4">
                                <i class="fas fa-check-circle fa-3x mb-3 text-success"></i>
                                <p>No significant matches found</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Analysis Section -->
        <div class="content-panel">
            <h4 class="mb-4">
                <i class="fas fa-chart-bar me-2"></i>Detailed Analysis
            </h4>
            
            <div class="row">
                <div class="col-md-6">
                    <h6>Risk Assessment</h6>
                    <div class="alert alert-{{ 'danger' if report_data.overall_summary.overall_risk_level == 'CRITICAL' else 'warning' if report_data.overall_summary.overall_risk_level == 'HIGH' else 'info' if report_data.overall_summary.overall_risk_level == 'MEDIUM' else 'success' }}">
                        <strong>{{ report_data.overall_summary.overall_risk_level }} RISK</strong><br>
                        {{ (report_data.recommendations[0] if report_data.recommendations else 'Review results and recommendations below.') }}
                    </div>
                </div>
                <div class="col-md-6">
                    <h6>Document Statistics</h6>
                    <ul class="list-unstyled">
                        <li><strong>Total Words:</strong> {{ report_data.document_analyzed.word_count }}</li>
                        <li><strong>Total Characters:</strong> {{ report_data.document_analyzed.char_count }}</li>
                        <li><strong>Grammar Issues:</strong> {{ report_data.grammar_analysis.total_issues }}</li>
                        <li><strong>Documents Compared:</strong> {{ report_data.overall_summary.total_documents_compared }}</li>
                    </ul>
                </div>
            </div>

            <!-- Recommendations -->
            <div class="mt-4">
                <h6>Recommendations</h6>
                <div class="alert alert-info">
                    <ul class="mb-0">
                        {% for recommendation in report_data.recommendations %}
                        <li>{{ recommendation }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Create plagiarism chart
        const ctx = document.getElementById('plagiarismChart').getContext('2d');
        const plagiarismPercentage = {{ report_data.overall_summary.highest_similarity }};
        const uniquePercentage = 100 - plagiarismPercentage;
        
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Plagiarized', 'Unique'],
                datasets: [{
                    data: [plagiarismPercentage, uniquePercentage],
                    backgroundColor: ['#f44336', '#4caf50'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        // Highlight plagiarized content
        function highlightContent() {
            const content = document.getElementById('originalContent').textContent;
            const matches = {{ report_data.plagiarism_results|tojson }};
            
            let highlightedContent = content;
            
            // Simple highlighting based on similarity matches
            matches.forEach(match => {
                if (match.similarity_percentage > 30) {
                    // This is a simplified highlighting - in a real implementation,
                    // you would need more sophisticated text matching
                    const className = match.similarity_percentage > 60 ? 'plagiarized-text' : 'similar-text';
                    // For demo purposes, we'll highlight some random sections
                }
            });
            
            document.getElementById('highlightedContent').innerHTML = 
                `<div class="unique-text">${content}</div>`;
        }

        // Action functions
        function checkGrammar() {
            alert('Grammar check feature would be implemented here');
        }

        function removePlagiarism() {
            alert('Plagiarism removal feature would be implemented here');
        }

        function downloadReport() {
            window.print();
        }

        function showAllMatches() {
            alert('Show all matches feature would be implemented here');
        }

        // Initialize highlighting
        highlightContent();
    </script>
</body>
</html>



